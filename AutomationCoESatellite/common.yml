# Get Signing key template for:
# - Read value from Environment variable
# - Convert Base64 into file
stages:
- stage: get_key_stage
  displayName: 'Get Key' 
  jobs:
  - job: get_key
    timeoutInMinutes: 0
    pool: 
      vmImage: 'windows-2022'
    steps:
    - pwsh: |
        $envVariable = "SigningKey"
        $filename = "$(Build.SourcesDirectory)\AutomationCoESatellite\Plugins\autocoe-plugins-master\Plugins\AutoCoEPluginKey.snk"                                                
        Write-Host "variable group "$(SigningKey)
        Write-Host "PipeLine-"$(SigningKeyNew)        
        $Base64Data=$(SigningKeyNew).ToString()
        if ( $Base64Data.ToString() -ne $NULL ) {        
        $bytes = [Convert]::FromBase64String($Base64Data.ToString())
        [IO.File]::WriteAllBytes($filename, $bytes)
        Write-Host "Signing Key file created successfully at " $filename
        }
        else
        { 
        Write-Host "Signing Key file Not Created"
        }
      displayName: 'Signing Key'