# Get Signing key template for:
# - Read value from Environment variable
# - Convert Base64 into file
stages:
- stage: get_key_stage
  displayName: 'Get Key' 
  jobs:
  - job: get_key
    timeoutInMinutes: 0
    pool: 
      vmImage: 'windows-2022'
    steps:
    - pwsh: |
        $envVariable = "SigningKey"
        Write-Host "Signing Key - "$(SigningKey)
        $filename = "$(Build.SourcesDirectory)\powercat-automation-kit\AutomationCoESatellite\Plugins\autocoe-plugins-master\Plugins\AutoCoEPluginKey.snk"
#if ( [System.Environment]::GetEnvironmentVariable($envVariable) -ne $NULL ) {        
#      $base64 = System.Environment]::GetEnvironmentVariable($envVariable)
       if ( $(SigningKey) -ne $NULL ) {  
        $bytes = [Convert]::FromBase64String($(SigningKey))
        [IO.File]::WriteAllBytes($filename, $bytes) 
        write-host "SNK file created successfully at $filename"
        }
        else
        {
        write-host "SigningKey Environment variable is not found. Please verify once"
        }
      displayName: 'Signing Key'