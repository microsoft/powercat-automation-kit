<!doctype html>
<html lang="en-us">
    <a id="topOfPage"></a>
    <head>
        

<meta property="og:title" content="Planlegger" />
<meta property="og:description" content="Automatiseringssett - Planlegger" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://microsoft.github.io/powercat-automation-kit/nb/features/scheduler/" /><meta property="article:section" content="features" />





<meta name="description" content="Automatiseringssett for Power Platform startsted. Definer og mål Power Automate Desktops avkastning på investeringen, koble til læringsinnhold og kundehistorier." />
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="x-ua-compatible" content="ie=edge">

<meta name="og:image" content="https://microsoft.github.io/powercat-automation-kit/images/logos/automation-kit.png" />
<meta name="og:image:alt" content="Automation Kit Logo" />

        <title>Automation Kit for Power Platform</title>
        
<link rel="icon" type="image/png" href="https://microsoft.github.io/powercat-automation-kit/images/favicon.png" />
<link rel="stylesheet" type="text/css" href="https://microsoft.github.io/powercat-automation-kit/css/style.min.900ac3346e02b249eca52c9ae838525e38bee9dc718fb9fd6cc0fbcfa923b149.css" integrity="sha256-kArDNG4CsknspSya6DhSXji&#43;6dxxj7n9bMD7z6kjsUk=">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/vs.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<link rel="stylesheet" type="text/css" href="https://microsoft.github.io/powercat-automation-kit/css/icons.css">
<link href="https://microsoft.github.io/powercat-automation-kit/css/survey-jquery/modern.min.css" type="text/css" rel="stylesheet">
<script type="module" src="https://unpkg.com/@fluentui/web-components"></script>

    </head>
    <body>
    

    
<nav class="navbar navbar-expand-lg navbar-dark bg-gray">
    <div class="container d-flex justify-content-between">
        <a class="navbar-item" href="https://microsoft.github.io/powercat-automation-kit/nb/">
          <img src="https://microsoft.github.io/powercat-automation-kit/images/logos/automation-kit.svg" alt="" width="112" height="56">
        </a>
        <span class="my-1 title text-black">Automatiseringssett for Power Platform</span>
    </div>
</nav>
<article>
  <a id="topofpage"></a>
  <div class="container">
    <div class="columns">
      <div class="column is-centered-tablet-portrait">
        <h1 class="title section-title">Planlegger</h1>
        <h5 class="subtitle is-5 is-muted"></h5>
        <div class="divider"></div>
      </div>
    </div>

    <div class="content">
      <nav id="TableOfContents">
  <ul>
    <li><a href="#introduksjon">Introduksjon</a></li>
    <li><a href="#skyflyter">Skyflyter</a></li>
    <li><a href="#kalender-visninger">Kalender-visninger</a></li>
    <li><a href="#visninger-for-dag-uke-måned">Visninger for dag, uke, måned</a>
      <ul>
        <li><a href="#timeplan">Timeplan</a></li>
      </ul>
    </li>
    <li><a href="#kjør-nå">Kjør nå</a>
      <ul>
        <li><a href="#planlagte-endringer">Planlagte endringer</a></li>
        <li><a href="#skrivebeskyttet-virkemåte-for-planlagte-flyter">Skrivebeskyttet virkemåte for planlagte flyter</a></li>
      </ul>
    </li>
    <li><a href="#feilmeldinger">Feilmeldinger</a>
      <ul>
        <li><a href="#feilmelding-invalidargument---finner-ikke-en-gyldig-tilkobling-knyttet-til-den-angitte-tilkoblingsreferansen">Feilmelding: &ldquo;InvalidArgument - Finner ikke en gyldig tilkobling knyttet til den angitte tilkoblingsreferansen.&rdquo;</a></li>
      </ul>
    </li>
    <li><a href="#notater">Notater</a></li>
    <li><a href="#installere">Installere</a></li>
    <li><a href="#veikart">Veikart</a></li>
    <li><a href="#tilbakemelding">Tilbakemelding</a></li>
  </ul>
</nav>
<h2 id="introduksjon">Introduksjon</h2>
<p>Automation Kit Scheduler gjør det mulig å vise tidsplanen for regelmessige Power Automate Cloud-flyter i løsninger som inkluderer kall til Power Automate Desktop-flyter.</p>
<p>Denne funksjonen ble oppdatert som en del av <a href="https://microsoft.github.io/powercat-automation-kit/nb/releases/march-2023">Mars 2023</a>, Senere utgivelser vil fortsette å forbedre og utvide funksjonaliteten planleggeren.</p>
<style>
    .outerBorder {
        border: 1px;
        color: black;
        border-style: solid;
        margin-bottom: 10px;
    }

    .outerBorder > center {
        padding: 5px;
    }
</style>
<div class="outerBorder">
    <center>

    <img src="https://microsoft.github.io/powercat-automation-kit/images/schedule.png" alt="Planlegger">

    </center>
</div>

<p>De viktigste funksjonene i planleggeren er:</p>
<ul>
<li>Muligheten til å vise tidsplanen for regelmessige skyflyter</li>
<li>Filtrer tidsplan etter maskin og maskingrupper</li>
<li>Kjøre en Power Automate Desktop-flyt</li>
<li>Vise tidsplan etter dag, uke, måned og tidsplanvisning</li>
<li>Vise statusen for Planlagte flyter (Vellykket, Feil eller Planlagt)</li>
<li>Vise varigheten av en Cloud Flow-kjøring</li>
<li>Vis detaljer om eventuelle feil.</li>
</ul>
<h2 id="skyflyter">Skyflyter</h2>
<p>Som nevnt ovenfor er det bare skyflyter som er inkludert som en del av en løsning. Den siste <a href="https://powerautomate.microsoft.com/vi-vn/blog/more-manageable-cloud-flows-with-dataverse-solutions-by-default/">https://powerautomate.microsoft.com/blog/more-manageable-cloud-flows-with-dataverse-solutions-by-default/</a> inneholder informasjon om hvordan du bruker den nye forhåndsvisningen av Dataverse-løsninger som standard for å sikre at skyflyter inkluderes i løsninger. Bruk av denne funksjonen kan hjelpe brukere med å sikre at de planlagte skyflytene som opprettes, er synlige i planleggeren.</p>
<h2 id="kalender-visninger">Kalender-visninger</h2>
<h2 id="visninger-for-dag-uke-måned">Visninger for dag, uke, måned</h2>
<p>Dag-, ukes- og månedsvisningene viser informasjon om Desktop Cloud-flytkjøringer som har kjørt eller er planlagt utført.</p>
<p>Elementene er fargekodet som følger:</p>
<ul>
<li>
<p>Grønt indikerer vellykket kjøring</p>
</li>
<li>
<p>Rødt indikerer mislykket kjøring</p>
</li>
<li>
<p>Blå indikerer en planlagt fremtidig kjøring.</p>
</li>
</ul>
<p>Status- og kjøreinformasjonen er tilgjengelig med lang berøring eller pekerfølsomme mus på arrangementet.</p>
<h3 id="timeplan">Timeplan</h3>
<style>
    .outerBorder {
        border: 1px;
        color: black;
        border-style: solid;
        margin-bottom: 10px;
    }

    .outerBorder > center {
        padding: 5px;
    }
</style>
<div class="outerBorder">
    <center>

    <img src="https://microsoft.github.io/powercat-automation-kit/images/scheduler-schedule-view.png" alt="Planlegger - Kjør nå">

    </center>
</div>

<p>Tidsplanvisningen inneholder et sett med skyflyter basert på tid fra gjeldende klokkeslett og fremtidige planlagte flyter i løpet av de neste dagene.</p>
<h2 id="kjør-nå">Kjør nå</h2>
<style>
    .outerBorder {
        border: 1px;
        color: black;
        border-style: solid;
        margin-bottom: 10px;
    }

    .outerBorder > center {
        padding: 5px;
    }
</style>
<div class="outerBorder">
    <center>

    <img src="https://microsoft.github.io/powercat-automation-kit/images/scheduler-run-now.png" alt="Planlegger - Kjør nå">

    </center>
</div>

<p>Den gjeldende versjonen av Kjør nå kjører Power Automate-skrivebordet. Det antas at det ikke er noen parametere som kreves for å utføre skrivebordsflyten. Den ekstra kjøreinformasjonen er tilgjengelig i informasjonen om siste kjøring på skrivebordet.</p>
<h3 id="planlagte-endringer">Planlagte endringer</h3>
<p>I fremtidige utgivelser vurderes følgende som nye funksjoner:</p>
<ol>
<li>
<p>Utfør skyflyten i stedet for skrivebordsflyten. Dette inkluderer deretter kjøreloggen for skyflyten og kjøring av eventuelle ekstra skyflythandlinger og parametere som sendes til skrivebordsflyten.</p>
</li>
<li>
<p>Åpne sider for skrivebords- og skyflytkjøring.</p>
</li>
</ol>
<h3 id="skrivebeskyttet-virkemåte-for-planlagte-flyter">Skrivebeskyttet virkemåte for planlagte flyter</h3>
<p>Når en flyt er planlagt for fremtidig kjøring, er den som standard satt til skrivebeskyttet modus og deaktivert for umiddelbar kjøring. Dette betyr at brukere ikke kan endre eller kjøre flyten før den planlagte datoen og klokkeslettet er passert. Denne virkemåten er utformet for å gi en bedre brukeropplevelse og forhindre utilsiktet kjøring av flyter før de er ment å kjøre.
Det er flere fordeler med denne tilnærmingen, inkludert:</p>
<ul>
<li>
<p>Forhindre utilsiktet kjøring: Ved å deaktivere umiddelbar kjøring av flyter som er planlagt for fremtidig kjøring, er det mindre sannsynlig at brukere ved et uhell kjører en flyt før den er ment å kjøre.</p>
</li>
<li>
<p>Forbedret forutsigbarhet: Ved å sette flyter i skrivebeskyttet modus når de planlegges for fremtidig kjøring, kan brukere enklere forutsi når flyter vil kjøre og sikre at de har de nødvendige inndataene og ressursene klare.</p>
</li>
<li>
<p>Konsekvent brukeropplevelse: Ved å standardisere virkemåten til planlagte flyter kan den gi en konsekvent og forutsigbar brukeropplevelse på tvers av alle forekomster av Flow.</p>
</li>
<li>
<p>Hvis du vil endre eller kjøre en planlagt flyt, kan brukere redigere flyten og oppdatere den planlagte datoen og klokkeslettet. Når den nye tidsplanen er angitt, deaktiveres flyten igjen for umiddelbar kjøring og settes til skrivebeskyttet modus til den nye tidsplanen er passert.</p>
</li>
</ul>
<h2 id="feilmeldinger">Feilmeldinger</h2>
<p>Mulige feilmeldinger som kan oppstå når du kjører flyt.</p>
<h3 id="feilmelding-invalidargument---finner-ikke-en-gyldig-tilkobling-knyttet-til-den-angitte-tilkoblingsreferansen">Feilmelding: &ldquo;InvalidArgument - Finner ikke en gyldig tilkobling knyttet til den angitte tilkoblingsreferansen.&rdquo;</h3>
<h4 id="beskrivelse">Beskrivelse</h4>
<p>Denne feilmeldingen angir vanligvis at det er et problem med tilkoblingsreferansen som er angitt i koden eller konfigurasjonen. Systemet kan ikke finne en gyldig tilkobling knyttet til referansen, noe som hindrer det i å utføre den forespurte handlingen.</p>
<h4 id="årsaker">Årsaker</h4>
<p>Det finnes flere mulige årsaker til denne feilmeldingen, inkludert:</p>
<ul>
<li>
<p>Feil eller ugyldig tilkoblingsreferanse: Den angitte tilkoblingsreferansen kan være ugyldig eller feil, noe som kan føre til at systemet ikke finner en gyldig tilkobling som er knyttet til den.</p>
</li>
<li>
<p>Tilkoblingen er slettet eller endret: Hvis tilkoblingen som brukes i koden eller konfigurasjonen, er slettet eller endret, kan det føre til at systemet ikke finner en gyldig tilkobling som er knyttet til referansen.</p>
</li>
<li>
<p>Tillatelsesproblem: Brukerkontoen som utfører koden eller konfigurasjonen, har kanskje ikke de nødvendige tillatelsene for å få tilgang til tilkoblingen eller ressursene som er knyttet til den.</p>
</li>
</ul>
<h4 id="resolusjon">Resolusjon</h4>
<p>Hvis du vil løse dette problemet, kan du gjøre følgende:</p>
<ul>
<li>
<p>Kontroller tilkoblingsreferansen: Kontroller tilkoblingsreferansen som er angitt i koden eller konfigurasjonen, og kontroller at den er gyldig og riktig.</p>
</li>
<li>
<p>Slett eksisterende tilkoblinger og opprett på nytt: Hvis flytkontrollen advarer om at en tilkoblingsreferanse ikke er brukt, kan du bruke flytkontrollen til å slette eksisterende tilkoblinger. Når tilkoblingene er slettet, kan du opprette tilkoblingsreferanser til maskin- eller maskingruppen på nytt for å aktivere flyten som skal kjøres.</p>
</li>
</ul>
<h2 id="notater">Notater</h2>
<p>For gjeldende versjon gjelder følgende merknader</p>
<ol>
<li>Bare Power Automate Desktop- og Power Automate-løsninger i en løsning vises</li>
<li>Minst én Power Automate Desktop er registrert og utført</li>
</ol>
<h2 id="installere">Installere</h2>
<p>For å installere planleggerløsningen kan du gjøre følgende:</p>
<ol>
<li>Sikre at Power Apps component framework er aktivert <a href="https://learn.microsoft.com/en-us/power-apps/developer/component-framework/component-framework-for-canvas-apps#enable-the-power-apps-component-framework-feature" target="_blank">Les også</a></li>
<li>Du har installert Creator Kit i målmiljøet. <a href="https://appsource.microsoft.com/en-us/product/dynamics-365/microsoftpowercatarch.creatorkit1" target="_blank">Installer fra appkilde</a></li>
<li>Du har lastet ned AutomationKit.zip-filen fra Aktiva-delen av den nyeste <a href="https://github.com/microsoft/powercat-automation-kit/releases" target="_blank">GitHub-utgivelse</a></li>
<li>Du har importert den nyeste AutomationKitScheduler_*_administrert.zip fil ved hjelp av. <a href='https://learn.microsoft.com/en-us/power-apps/maker/data-platform/import-update-export-solutions' target="_blank">Les også</a></li>
</ol>
<h2 id="veikart">Veikart</h2>
<p>Du kan besøke vår <a href="https://github.com/microsoft/powercat-automation-kit/issues?q=is%3Aissue+is%3Aopen+label%3Ascheduler" target="_blank">GitHub-problemer</a> for å se foreslåtte nye funksjoner.</p>
<p>Du kan legge til en ny <a href="https://github.com/microsoft/powercat-automation-kit/issues/new?assignees=&labels=automation-kit%2Cenhancement%2Cscheduler&template=2-automation-kit-feature.yml&title=%5BAutomation+Kit+-+Feature%5D%3A+FEATURE+TITLE" target="_blank">Forespørsel om planleggerfunksjon</a></p>
<h2 id="tilbakemelding">Tilbakemelding</h2>













<script>
    
    
    data = "{\r\n  \"triggers\": [\r\n    {\r\n      \"type\": \"setvalue\",\r\n      \"expression\": \"{send-results} = true\",\r\n      \"setToName\": \"code\",\r\n      \"setValue\": \"Feedback-AK4PP-Scheduler\"\r\n    }\r\n  ],\r\n  \"pages\": [\r\n    {\r\n      \"name\": \"welcome\",\r\n      \"elements\": [\r\n        {\r\n          \"type\": \"checkbox\",\r\n          \"name\": \"features\",\r\n          \"title\": {\r\n            \"default\": \"Which of the following is most useful for your related to Scheduler functionality?\",\r\n            \"nb\": \"Hvilket av følgende er mest nyttig for din tilknytning til Scheduler-funksjonalitet?\"\r\n          },\r\n          \"isRequired\": true,\r\n          \"colCount\": 1,\r\n          \"hasOther\": true,\r\n          \"choices\": [\r\n            {\r\n              \"value\": \"The ability to view schedules by day\",\r\n              \"text\": {\r\n                \"default\": \"The ability to view schedules by day\",\r\n                \"nb\": \"Muligheten til å vise tidsplaner etter dag\"\r\n              }\r\n            },\r\n            {\r\n              \"value\": \"The ability to view schedules by week\",\r\n              \"text\": {\r\n                \"default\": \"The ability to view schedules by week\",\r\n                \"nb\": \"Muligheten til å vise tidsplaner etter uke\"\r\n              }\r\n            },\r\n            {\r\n              \"value\": \"The ability to view schedules by month\",\r\n              \"text\": {\r\n                \"default\": \"The ability to view schedules by month\",\r\n                \"nb\": \"Muligheten til å vise tidsplaner etter måned\"\r\n              }\r\n            },\r\n            {\r\n              \"value\": \"The ability to run a flow\",\r\n              \"text\": {\r\n                \"default\": \"The ability to run a flow\",\r\n                \"nb\": \"Muligheten til å kjøre en flyt\"\r\n              }\r\n            },\r\n            {\r\n              \"value\": \"See the results of runs\",\r\n              \"text\": {\r\n                \"default\": \"See the results of runs\",\r\n                \"nb\": \"Se resultatene av løpene\"\r\n              }\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"type\": \"checkbox\",\r\n          \"name\": \"new-features\",\r\n          \"title\": {\r\n            \"default\": \"What new features would you like added to the Scheduler functionality?\",\r\n            \"nb\": \"Hvilke nye funksjoner vil du legge til i Scheduler-funksjonaliteten?\"\r\n          },\r\n          \"isRequired\": true,\r\n          \"colCount\": 1,\r\n          \"hasOther\": true,\r\n          \"choices\": [\r\n            {\r\n              \"value\": \"The ability to filter by status (Success, Fail, Scheduled)\",\r\n              \"text\": {\r\n                \"default\": \"The ability to filter by status (Success, Fail, Scheduled)\",\r\n                \"nb\": \"Muligheten til å filtrere etter status (Vellykket, Mislykket, Planlagt)\"\r\n              }\r\n            },\r\n            {\r\n              \"value\": \"The ability to filter by machine / machine group\",\r\n              \"text\": {\r\n                \"default\": \"The ability to filter by machine / machine group\",\r\n                \"nb\": \"Muligheten til å filtrere etter maskin / maskingruppe\"\r\n              }\r\n            },\r\n            {\r\n              \"value\": \"Define alerts for failed runs\",\r\n              \"text\": {\r\n                \"default\": \"Define alerts for failed runs\",\r\n                \"nb\": \"Definere varsler for mislykkede kjøringer\"\r\n              }\r\n            },\r\n            {\r\n              \"value\": \"Restart / Stop flow execution\",\r\n              \"text\": {\r\n                \"default\": \"Restart / Stop flow execution\",\r\n                \"nb\": \"Start på nytt / stopp flytkjøring\"\r\n              }\r\n            },\r\n            {\r\n              \"value\": \"Define dependencies between flow runs\",\r\n              \"text\": {\r\n                \"default\": \"Define dependencies between flow runs\",\r\n                \"nb\": \"Definere avhengigheter mellom flytkjøringer\"\r\n              }\r\n            },\r\n            {\r\n              \"value\": \"See the results of runs\",\r\n              \"text\": {\r\n                \"default\": \"See the results of runs\",\r\n                \"nb\": \"Se resultatene av løpene\"\r\n              }\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"type\": \"boolean\",\r\n          \"name\": \"send-results\",\r\n          \"label\": {\r\n            \"default\": \"Do you want to send the feedback on Scheduler?\",\r\n            \"nb\": \"Vil du sende tilbakemeldingen på Scheduler?\"\r\n          },\r\n          \"isRequired\": true\r\n        },\r\n        {\r\n          \"type\": \"html\",\r\n          \"visibleIf\": \"{send-results} = true\",\r\n          \"html\": {\r\n            \"default\": \"We look forward to getting your feedback. As a core Automation Kit team we use the feedback to improving our guidance and roadmap\",\r\n            \"nb\": \"Vi ser frem til å få din tilbakemelding. Som et kjerneteam for automatiseringssett bruker vi tilbakemeldingene til å forbedre veiledningen og veikartet vårt\"\r\n          }\r\n        },\r\n        {\r\n          \"type\": \"text\",\r\n          \"name\": \"optional-name\",\r\n          \"title\": {\r\n            \"default\": \"You name (optional)\",\r\n            \"nb\": \"You name (valgfritt)\"\r\n          },\r\n          \"visibleIf\": \"{send-results} = true\"\r\n        },\r\n        {\r\n          \"type\": \"text\",\r\n          \"name\": \"optional-name\",\r\n          \"title\": {\r\n            \"default\": \"You name (optional)\",\r\n            \"nb\": \"You name (valgfritt)\"\r\n          },\r\n          \"visibleIf\": \"{send-results} = true\"\r\n        },\r\n        {\r\n          \"type\": \"text\",\r\n          \"name\": \"optional-organization\",\r\n          \"title\": {\r\n            \"default\": \"You organization (optional)\",\r\n            \"nb\": \"Du organisasjon (valgfritt)\"\r\n          },\r\n          \"visibleIf\": \"{send-results} = true\"\r\n        },\r\n        {\r\n          \"type\": \"dropdown\",\r\n          \"name\": \"optional-role\",\r\n          \"title\": {\r\n            \"default\": \"Role (optional)\",\r\n            \"nb\": \"Rolle (valgfritt)\"\r\n          },\r\n          \"choices\": [\r\n            {\r\n              \"value\": \"COE Administrator\",\r\n              \"text\": {\r\n                \"default\": \"COE Administrator\",\r\n                \"nb\": \"COE-administrator\"\r\n              }\r\n            },\r\n            {\r\n              \"value\": \"Automation Engineer\",\r\n              \"text\": {\r\n                \"default\": \"Automation Engineer\",\r\n                \"nb\": \"Automasjonsingeniør\"\r\n              }\r\n            },\r\n            {\r\n              \"value\": \"Business User\",\r\n              \"text\": {\r\n                \"default\": \"Business User\",\r\n                \"nb\": \"Bedriftsbruker\"\r\n              }\r\n            },\r\n            {\r\n              \"value\": \"Other\",\r\n              \"text\": {\r\n                \"default\": \"Other\",\r\n                \"nb\": \"Annen\"\r\n              }\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"type\": \"text\",\r\n          \"name\": \"optional-role-other\",\r\n          \"title\": {\r\n            \"default\": \"You role\",\r\n            \"nb\": \"Din rolle\"\r\n          },\r\n          \"visibleIf\": \"{optional-role} = 'Other'\"\r\n        },\r\n        {\r\n          \"type\": \"text\",\r\n          \"name\": \"optional-contact\",\r\n          \"title\": {\r\n            \"default\": \"You contact details (optional)\",\r\n            \"nb\": \"Du kontaktinformasjon (valgfritt)\"\r\n          },\r\n          \"visibleIf\": \"{send-results} = true\"\r\n        },\r\n        {\r\n          \"type\": \"comment\",\r\n          \"name\": \"other-feedback\",\r\n          \"title\": {\r\n            \"default\": \"Did you have any other feedback?\",\r\n            \"nb\": \"Har du noen andre tilbakemeldinger?\"\r\n          },\r\n          \"visibleIf\": \"{send-results} = true\"\r\n        },\r\n        {\r\n          \"type\": \"feedback-task\",\r\n          \"name\": \"send-results\",\r\n          \"title\": {\r\n            \"default\": \"Send your feedback now?\",\r\n            \"nb\": \"Send tilbakemelding nå?\"\r\n          },\r\n          \"destination\": \"https://aka.ms/ak4pp-feedback2\",\r\n          \"visibleIf\": \"{send-results} = true\"\r\n        },\r\n        {\r\n          \"type\": \"html\",\r\n          \"visibleIf\": \"{send-results-status.length} \u003e 0\",\r\n          \"html\": {\r\n            \"default\": \"Status: {send-results-status}\",\r\n            \"nb\": \"Status: \"\r\n          }\r\n        }\r\n      ]\r\n    }\r\n  ]\r\n}"
    
</script>

<style>
    #questions {
        margin-bottom: 20px;
    }
    .sv-btn {
        border-radius: 0.3em;
    }
</style>

<div id="questions">
</div>

<noscript>
    <p>JavaScript må være aktivert for å se dette innholdet</p>
</noscript>



<script>
    class QuestionExtensions {
        constructor() {
            this.feedbackTask();
            this.importTask();
            this.imageTask();
            this.downloadTask();
            this.handoffTask();
            this.createConnection();
            this.markdown();
        }

        markdown() {
            var widget = {
                name: "markdown",
                title: "Markdown",
                iconName: "",
                widgetIsLoaded: function () {
                    return true;
                },
                defaultJSON: {

                },
                isFit: function (question) {
                    return question.getType() === "markdown";
                },
                isDefaultRender: false,
                htmlTemplate: "<div id='markdownContent'></div>",
                activatedByChanged: function (activatedBy) {
                    Survey.JsonObject.metaData.addClass(
                        "markdown", [
                        {
                            name: "name",
                            type: "text",
                            default: ""
                        },
                        {
                            name: "title",
                            type: "text",
                            default: ""
                        },
                        {
                            name: "markdown",
                            type: "text",
                            default: ""
                        }
                    ], null, "empty");
                },
                afterRender: function (question, el) {
                    question.valueChangedCallback = initWidget;
                    question.readOnlyChangedCallback = initWidget;

                    if (!question.survey[question.name + '_loaded']) {
                        initWidget();
                    }

                    function initWidget() {
                        question.survey.setValue(question.name + '_loaded', true)
                        $("#markdownContent").attr('id', question.name)
                        const converter = new showdown.Converter();
                        $("#" + question.name).html(converter.makeHtml(question.markdown));
                    };
                },
                willUnmount: function (question, el) {
                    el.innerHTML = null;
                    question.readOnlyChangedCallback = null;
                }
            };
            Survey.CustomWidgetCollection.Instance.addCustomWidget(widget, "customtype");
        }

        createConnection() {
            var widget = {
                name: "create-connection",
                title: "Create Connection",
                iconName: "",
                widgetIsLoaded: function () {
                    return true;
                },
                defaultJSON: {

                },
                isFit: function (question) {
                    return question.getType() === "create-connection";
                },
                isDefaultRender: false,
                htmlTemplate: "<div><fluent-button appearance='accent' id='createConnection'></fluent-button></div>",
                activatedByChanged: function (activatedBy) {
                    Survey.JsonObject.metaData.addClass(
                        "create-connection", [
                        {
                            name: "name",
                            type: "text",
                            default: ""
                        },
                        {
                            name: "title",
                            type: "text",
                            default: ""
                        },
                        {
                            name: "connector",
                            type: "text",
                            default: ""
                        },
                        {
                            name: "environment",
                            type: "text",
                            default: ""
                        }
                    ], null, "empty");
                },
                afterRender: function (question, el) {
                    question.valueChangedCallback = initWidget;
                    question.readOnlyChangedCallback = initWidget;

                    if (!question.survey[question.name + '_loaded']) {
                        initWidget();
                    }

                    function initWidget() {
                        question.survey.setValue(question.name + '_loaded', true)
                        $("#createConnection").attr('id', question.name)
                        $("#" + question.name).closest(".sv-question").parent().attr("style","")
                        $("#" + question.name).html(question.title);
                        $("#" + question.name).on("click", function() {
                            let environment = question.survey.data[question.environment]
                            if ( typeof environment !== "undefined" && environment.length > 0 ) {
                                environment = environment.replaceAll("/home", "/connections/available?apiName=" + question.connector)
                                window.open(environment)
                            }
                        });
                    };
                },
                willUnmount: function (question, el) {
                    el.innerHTML = null;
                    question.readOnlyChangedCallback = null;
                }
            };

            
            Survey.CustomWidgetCollection.Instance.addCustomWidget(widget, "customtype");
        }

        downloadTask() {
            var widget = {
                name: "download-task",
                title: "Download Task",
                iconName: "",
                widgetIsLoaded: function () {
                    return true;
                },
                defaultJSON: {

                },
                isFit: function (question) {
                    return question.getType() === "download-task";
                },
                isDefaultRender: false,
                htmlTemplate: "<div><fluent-button appearance='accent' id='downloadLink'>Laste ned</fluent-button><a id='downloadData' style='display:none'></a></div>",
               activatedByChanged: function (activatedBy) {
                    Survey.JsonObject.metaData.addClass(
                        "download-task", [
                        {
                            name: "name",
                            type: "text",
                            default: ""
                        },
                        {
                            name: "filter",
                            type: "text",
                            default: ""
                        },
                        {
                            name: "text",
                            type: "text",
                            default: ""
                        },
                        {
                            name: "fileName",
                            type: "text",
                            default: "results.json"
                        }
                    ], null, "empty");
                },
                afterRender: function (question, el) {
                    question.valueChangedCallback = initWidget;
                    question.readOnlyChangedCallback = initWidget;

                    if (!question.survey[question.name + '_loaded']) {
                        initWidget();
                    }

                    function initWidget() {
                        question.survey.setValue(question.name + '_loaded', true)
                        $("#downloadLink").html(question.text);
                        $("#downloadLink").on("click", function() {
                            var data = question.survey.data;
                            if ( question.filter.length > 0 ) {
                                var newData = {}
                                for (const key in data) {
                                    if (data.hasOwnProperty(key) && key.startsWith(question.filter + "-")) {
                                        newData[key] = data[key]
                                    }
                                }
                                data = newData;
                            }
                            var jsonString = JSON.stringify(data);
                            var blob = new Blob([jsonString], { type: 'application/json' });
                            var anchor = document.getElementById('downloadData');
                            anchor.download = question.fileName;
                            anchor.href = window.URL.createObjectURL(blob);
                            anchor.dataset.downloadUrl = [ 'application/json', anchor.download, anchor.href].join(':');
                            anchor.click()
                        });
                    };
                },
                willUnmount: function (question, el) {
                    el.innerHTML = null;
                    question.readOnlyChangedCallback = null;
                }
            };
            Survey.CustomWidgetCollection.Instance.addCustomWidget(widget, "customtype");
        }

        handoffTask() {
            var widget = {
                name: "handoff-task",
                title: "Handoff Task",
                iconName: "",
                widgetIsLoaded: function () {
                    return true;
                },
                defaultJSON: {

                },
                isFit: function (question) {
                    return question.getType() === "handoff-task";
                },
                isDefaultRender: false,
                htmlTemplate: "<div><a class='button cta rounded primary-btn raised' id='handoff'></a>",
                activatedByChanged: function (activatedBy) {
                    Survey.JsonObject.metaData.addClass(
                        "handoff-task", [
                        {
                            name: "destination",
                            type: "text",
                            default: ""
                        },
                        {
                            name: "text",
                            type: "text",
                            default: ""
                        }
                    ], null, "empty");
                },
                afterRender: function (question, el) {
                    question.valueChangedCallback = initWidget;
                    question.readOnlyChangedCallback = initWidget;

                    if (!question.survey[question.name + '_loaded']) {
                        initWidget();
                    }

                    function initWidget() {
                        question.survey.setValue(question.name + '_loaded', true)
                        $("#handoff").html(question.text);
                        $("#handoff").on("click", function() {
                            const parameterRegularExpression = new RegExp("\{([^}]+)\}","g")
                            var matches = question.destination.match(parameterRegularExpression)
                            var destination = question.destination
                            for ( var i = 0; i < matches.length; i++) {
                                let name = matches[i].replaceAll("{","").replaceAll("}","")
                                destination = destination.replaceAll(matches[i], question.survey.data[name])
                            }
                            window.location = destination;
                        })  
                    };
                },
                willUnmount: function (question, el) {
                    el.innerHTML = null;
                    question.readOnlyChangedCallback = null;
                }
            };
            Survey.CustomWidgetCollection.Instance.addCustomWidget(widget, "customtype");
        }

        feedbackTask() {
            var widget = {
                name: "feedback-task",
                title: "Feedback Task",
                iconName: "",
                widgetIsLoaded: function () {
                    return true;
                },
                defaultJSON: {

                },
                isFit: function (question) {
                    return question.getType() === "feedback-task";
                },
                isDefaultRender: false,
                htmlTemplate: "<div><fluent-button appearance='accent' id='sendFeedback'>Fullfør spørsmål og send tilbakemelding</fluent-button>",
                activatedByChanged: function (activatedBy) {
                    Survey.JsonObject.metaData.addClass(
                        "feedback-task", [
                        {
                            name: "destination",
                            type: "text",
                            default: ""
                        }
                    ], null, "empty");
                },
                afterRender: function (question, el) {
                    question.valueChangedCallback = initWidget;
                    question.readOnlyChangedCallback = initWidget;

                    if (!question.survey[question.name + '_loaded']) {
                        initWidget();
                    }

                    function initWidget() {
                        $("#sendFeedback").on("click", function() {
                            if ( question.survey.completeLastPage() ) {
                                question.survey.setValue(question.name + "-status", 'Sende tilbakemelding')

                                $.ajax({
                                        type: "GET",
                                        url: question.destination,
                                        success: function (response) {
                                            $.ajax
                                            ({
                                                type: "POST",
                                                url: response.url,
                                                dataType: 'json',
                                                async: false,
                                                cors: true,
                                                data: JSON.stringify(question.survey.data),
                                                success: function (result) {
                                                    question.survey.setValue(question.name + "-status", result.status)
                                                },
                                                error: function() {
                                                    question.survey.setValue(question.name + "-status", 'Kan ikke sende tilbakemelding')
                                                }
                                            });
                                            }
                                    });
                            } else {
                                question.survey.setValue(question.name + "-status", 'Valider at spørsmålene er fullført')
                            }
                        })  
                    };
                },
                willUnmount: function (question, el) {
                    el.innerHTML = null;
                    question.readOnlyChangedCallback = null;
                }
            };
            Survey.CustomWidgetCollection.Instance.addCustomWidget(widget, "customtype");
        }

        importTask() {
            var widget = {
                name: "importTask",
                title: "Import Task",
                iconName: "",
                widgetIsLoaded: function () {
                    return true;
                },
                defaultJSON: {

                },
                isFit: function (question) {
                    return question.getType() === "import-task";
                },
                isDefaultRender: false,
                htmlTemplate: "<div></div>",
                activatedByChanged: function (activatedBy) {
                    Survey.JsonObject.metaData.addClass(
                        "import-task", [
                        {
                            name: "src",
                            type: "text",
                            default: ""
                        },
                        {
                            name: "mode",
                            type: "text",
                            default: ""
                        }
                    ], null, "empty");
                },
                afterRender: function (question, el) {
                    question.valueChangedCallback = initWidget;
                    question.readOnlyChangedCallback = initWidget;

                    if (!question.survey[question.name + '_loaded']) {
                        initWidget();
                    }

                    function initWidget() {
                        console.log('Loading')
                        fetch(question.src)
                            .then(function (response) {
                                if (response.ok) {
                                    return response.text();
                                }
                                throw new Error('Nettverksresponsen var ikke ok.');
                            })
                            .then(function (jsonContent) {
                                question.survey[question.name + '_loaded'] = true;
                                var importSurvey = new Model(jsonContent);
                                if (question.hasOwnProperty('mode')) {
                                    switch (question.mode) {
                                        case 'merge':
                                            for (var i = 0; i < importSurvey.pages.length; i++) {
                                                for (var q = 0; q < question.survey.pages.length; q++) {
                                                    if (question.survey.pages[q].name === importSurvey.pages[i].name) {
                                                        for (var e = 0; e < importSurvey.pages[i].elements.length; e++) {
                                                            question.survey.pages[q].elements.push(importSurvey.pages[i].elements[e])
                                                        }
                                                    }
                                                }
                                            }
                                            break;
                                        case 'insert':
                                        case 'replace':
                                            var selectedPage = question.survey.currentPageNo;
                                            var newPages = [];
                                            
                                            for (var i = 0; i < importSurvey.pages.length; i++) {
                                                var newPage = question.survey.addNewPage(importSurvey.pages[i].name);
                                                newPages.push(newPages)
                                                for (var e = 0; e < importSurvey.pages[i].elements.length; e++) {
                                                    newPage.elements.push(importSurvey.pages[i].elements[e])
                                                }
                                                newPage.title = importSurvey.pages[i].title;
                                                newPage.visibleIf = importSurvey.pages[i].visibleIf;
                                                
                                                question.survey.pages.splice(selectedPage + i + 1, 0, question.survey.pages.splice(question.survey.pages.length - 1, 1)[0]);
                                                question.survey.runConditions();
                                                question.survey.updateVisibleIndexes();
                                            }
                                            if (question.mode == 'replace') {
                                                question.survey.removePage(question.survey.pages[selectedPage]);
                                            }
                                            question.survey.currentPageNo = selectedPage;
                                            break;
                                        default:
                                            for (var i = 0; i < importSurvey.pages.length; i++) {
                                                var newPage = question.survey.addNewPage(importSurvey.pages[i].name);
                                                for (var e = 0; e < importSurvey.pages[i].elements.length; e++) {
                                                    newPage.elements.push(importSurvey.pages[i].elements[e])
                                                }
                                                newPage.title = importSurvey.pages[i].title;
                                                newPage.visibleIf = importSurvey.pages[i].visibleIf;
                                            }
                                    }
                                }
                            })
                    };
                },
                willUnmount: function (question, el) {
                    el.innerHTML = null;
                    question.readOnlyChangedCallback = null;
                }
            };

            Survey.CustomWidgetCollection.Instance.addCustomWidget(widget, "customtype");
        }

        imageTask() {
            var self = this;
            var widget = {
                name: "imageTask",
                title: "Image Task",
                iconName: "",
                widgetIsLoaded: function () {
                    return true;
                },
                defaultJSON: {

                },
                isFit: function (question) {
                    return question.getType() === "image-task";
                },
                isDefaultRender: false,
                htmlTemplate: "<div></div>",
                activatedByChanged: function (activatedBy) {
                    Survey.JsonObject.metaData.addClass(
                        "image-task", [
                        {
                            name: "src",
                            type: "text",
                            default: ""
                        }
                    ], null, "empty");
                },
                afterRender: function (question, el) {
                    if (!question.survey[question.name + '_loaded']) {
                        initWidget();
                    }

                    question.valueChangedCallback = initWidget;
                    question.readOnlyChangedCallback = initWidget;

                    function initWidget() {
                        if (question.survey[question.name + '_loaded']) {
                            return;
                        }

                        fetch(question.src)
                            .then(function (response) {
                                if (response.ok) {
                                    return response.text();
                                }
                                throw new Error('Nettverksresponsen var ikke ok.');
                            })
                            .then(function (svgContent) {
                                el.innerHTML = svgContent;
                                if (typeof self !== "undefined") {
                                    self.componentSelect(question.survey, question, el);
                                }
                            })
                    }
                },
                willUnmount: function (question, el) {
                    el.innerHTML = null;
                    question.readOnlyChangedCallback = null;
                }
            };

            Survey.CustomWidgetCollection.Instance.addCustomWidget(widget, "customtype");
        }

        componentSelect(survey, question, element) {
        console.log('Component Loaded')
        var itemSelected =  ''
        var groupSelected = ''
        var itemUnselected =  ''
        var groupUnselected = ''

        var requiredQuestions = []
        
        for (const a of element.querySelectorAll("a")) {
            if ( typeof a.href !== "undefined" && a.href.baseVal.startsWith("template://") )  {
                var rect = this.findRect(a);
                if (rect == null) {
                    var rect = this.findPath(a);
                }

                if (rect != null)
                {
                    var classVal = rect.getAttribute("class");
                    switch ( a.href.baseVal ) {
                        case "template://group/selected":
                            groupSelected = classVal;
                            break;
                        case "template://group/unselected":
                            groupUnselected = classVal;
                            break;
                        case "template://item/selected":
                            itemSelected = classVal;
                            break;
                        case "template://item/unselected":
                            itemUnselected = classVal;
                            break;
                    }
                }
            }

            if ( typeof a.href !== "undefined" && a.href.baseVal.startsWith("required://") )  {
                var parts = a.href.baseVal.split('/')
                var requiredQuestionId = parts[parts.length -1]
                if ( requiredQuestions.indexOf(requiredQuestionId) == -1) {
                    requiredQuestions.push(requiredQuestionId)
                }
            }
        }

        this.updateComplete(survey, question, requiredQuestions, element)

        for (const a of element.querySelectorAll("a")) {        
            if ( typeof a.href !== "undefined" ) {
                var handled = false;
                if (a.href.baseVal.startsWith("question://") || a.href.baseVal.startsWith("option://")) {
                    console.log('Found question ' + a.href.baseVal )
                    this.setupQuestion(survey, a.href.baseVal, a, itemSelected)

                    a.addEventListener("click", (event) => {
                        event.preventDefault();
                        var aLink = this.findLink(event.target);
                        if ( aLink !== null) {
                            var rect = this.findRect(aLink);
                            if (rect == null) {
                                var rect = this.findPath(aLink);
                            }

                            var newClass = itemSelected;
                            if (rect.getAttribute("class") == itemSelected) {
                                newClass = itemUnselected
                            }
                            this.selectQuestion(survey, a.href.baseVal, newClass == itemSelected, element, itemUnselected, () => {
                                this.updateComplete(survey, question, requiredQuestions, element)
                            });

                            if (rect != null) {
                                rect.setAttribute("class", newClass)
                            }
                        }
                    })
                    handled = true;
                }

                if (a.href.baseVal.startsWith("navigate://")) {
                    console.log('Found navigation link ' + a.href.baseVal )
                    a.addEventListener("click", (event) => {
                        event.preventDefault();

                        var parts = a.href.baseVal.split('/');
                    
                        survey.currentPageNo = parseInt(parts[parts.length-1]) - 1;
                    });
                    handled = true;
                }

                if (a.href.baseVal.startsWith("popup://")) {
                    console.log('Found popup link ' + a.href.baseVal )
                    
                    
                    handled = true;
                }

                if (!handled) {
                    a.addEventListener("click", (event) => {
                        event.preventDefault();
                    });
                }
            }
        }
    }
    
    unique(arr) {
        var a = arr.concat();
        for(var i=0; i<a.length; ++i) {
            for(var j=i+1; j<a.length; ++j) {
                if(a[i] === a[j])
                    a.splice(j--, 1);
            }
        }

        return a;
    };

    findQuestion(survey, questionId) {
        var questionMatch = null;
        for ( var p = 0; p < survey.pages.length; p++ ) {
            for ( var q = 0; q < survey.pages[p].questions.length; q++ ) 
            {
                if ( survey.pages[p].questions[q].name == questionId )
                {
                    questionMatch = survey.pages[p].questions[q];
                    break;
                }
            }
        }
        return questionMatch;
    }

    updateComplete(survey, question, requiredList, element) {
        var requiredMatch = 0;
        for (const a of element.querySelectorAll("a")) {
            if ( typeof a.href !== "undefined" && a.href.baseVal.startsWith("required://") )  {
                var parts = a.href.baseVal.split('/')
                var requiredQuestionId = parts[parts.length -1]
                var hasValue = false;
                if (
                    typeof survey.data[requiredQuestionId] !== "undefined" && 
                    (typeof survey.data[requiredQuestionId].length === "number" && survey.data[requiredQuestionId].length > 0)
                ) {
                    requiredMatch++;
                    hasValue = true;
                }

                var path = this.findPath(a);
                if (path != null) {
                    if (hasValue) {
                        path.setAttribute('style', 'display:none')
                    } else {
                        path.setAttribute('style', '')
                    }
                }
            }
        }

        if (typeof question.name === "string") {
            if (requiredMatch == requiredList.length) {
                survey.setValue(question.name, 'complete')
            } else {
                survey.clearValue(question.name)
            }
        } 
    }

    setupQuestion(survey, questionId, element, itemSelected) {
        var parts = questionId.split('/');
        var val = parts[parts.length - 1];
        var question = parts[parts.length - 2];
        
        var currentVal = survey.data[question];

        if ( typeof currentVal === "undefined") {
            return;
        }

        var newClass = '';

        if ( questionId.startsWith('option://') ) {
            if ( val === currentVal ) {
                newClass = itemSelected;
            }
        }

        if ( questionId.startsWith('question://') && currentVal.indexOf(val) >= 0 ) {
            newClass = itemSelected;
        }

        if ( newClass.length > 0)
        {
        var rect = this.findRect(element);
        if (rect == null) {
            var rect = this.findPath(element);
        }
        
        rect.setAttribute('class', newClass)
        }
    }

    selectQuestion(survey, questionId, selected, element, itemUnselected, callback) {
        var parts = questionId.split('/');
        var val = parts[parts.length - 1];
        var question = parts[parts.length - 2];
        var group = parts[parts.length - 3];

        if ( questionId.startsWith('option://') ) {
            this.unselectGroup(element, group, question, itemUnselected);
        }

        if ( questionId.startsWith('option://') && !selected ) {
            survey.clearValue(question);
            if (typeof callback === "function") {
                callback()
            }
            return;
        }

        var newVal = val;

        var currentVal = survey.data[question];
        if ( typeof currentVal === "undefined") {
            if ( questionId.startsWith('question://') ) {
                newVal = selected ? [ val ] : [];
            }
        }
        else
        {
            if ( questionId.startsWith('question://') ) {
                newVal = selected ? [ val ] : [];
                newVal = this.unique(currentVal.concat(newVal));
                if ( !selected ) {
                    
                    var index = newVal.indexOf(val);
                    if (index > -1) {
                        newVal.splice(index, 1);
                    }
                }
            }
        }

        survey.setValue(question, newVal);

        if (typeof callback === "function") {
            callback()
        }
    }

    unselectGroup(element, group, question, classToApply) {
        var items = this.findOptions(element, group, question);

        items.forEach( item => {
            var rect = this.findRect(item);
            if (rect == null) {
                var rect = this.findPath(item);
            }

            if (rect != null) {
                rect.setAttribute('class', classToApply)
            }
        });
    }

    findOptions(element, group, question) {
        var options = []
        this.findChildLink(element, 'option://' + group + "/" + question, options)
        return options;
    }

    findLink(element, startsWith) {
        if (typeof element !== "undefined") {
            if ( typeof element.href !== "undefined" ) {
                if ( typeof startsWith !== "undefined") {
                    if ( element.href.baseVal.startsWith(startsWith) ) {
                        return element;
                    }

                    if ( typeof element.parentElement !== "undefined" ) {
                        return this.findLink(element.parentElement, startsWith)
                    }
                } else {
                    return element
                }
            }

            if ( typeof element.parentElement !== "undefined" ) {
                return this.findLink(element.parentElement, startsWith)
            }
        }
    
        return null;
    }

    findChildLink(element, startsWith, matches) {
        if ( typeof element === "undefined" ) {
            return null;
        }

        if ( typeof element.href !== "undefined" && typeof element.href.baseVal !== "undefined") {
            if ( element.href.baseVal.startsWith(startsWith) ) {
                if ( startsWith !== "undefined" && element.href.baseVal.startsWith(startsWith) ) {
                    matches.push(element);
                }
            }
        }

        if ( typeof element.childNodes !== "undefined" ) {
            for (let child of element.childNodes) {
                if ( typeof startsWith === "string" && typeof child.href !== "undefined" && typeof child.href.baseVal !== "undefined") {
                    if ( child.href.baseVal.startsWith(startsWith) ) {
                        matches.push(child);
                    }
                }
                
                this.findChildLink(child, startsWith, matches);
            }
        }
    }

    findRect(element) {
        for (const rect of element.querySelectorAll("rect")) {
            return rect;
        }
        return null;
    }

    findPath(element) {
        for (const item of element.querySelectorAll("path")) {
            return item;
        }
        return null;
    }
    }

    function contains(params) {
        try {
            if (Array.isArray(params[0]) && Array.isArray(params[1])) {
                for (var i = 0; i < params[1].length; i++) {
                    if (params[0].includes(params[1][i])) {
                        return true
                    }
                }
            }

            if (Array.isArray(params[0]) && !Array.isArray(params[1])) {
                return params[0].includes(params[1]);
            }
        } catch {
            return false
        }
        return false
    }

    function stringLength(params) {
        try {
            return params[0].length
        } catch {
            return false
        }
        return false
    }

    function startsWithFunction(params) {
        try {
            return params[0].startsWith(params[1])
        } catch {
            return false
        }
        return false
    }

    function ceilingFunction(params) {
        try {
            return Math.ceil(params[0])
        } catch {
            return ''
        }
    }

    function parseIntFunction(params) {
        try {
            return parseInt(params[0])
        } catch {
            return ''
        }
    }

    document.addEventListener("DOMContentLoaded", () => {
        
        Survey.FunctionFactory
            .Instance
            .register("contains", contains);
        Survey.FunctionFactory
            .Instance
            .register("len", stringLength);
        Survey.FunctionFactory
            .Instance
            .register("startsWith", startsWithFunction);

        Survey.FunctionFactory
            .Instance
            .register("int", parseIntFunction)

        Survey.FunctionFactory
            .Instance
            .register("ceil", ceilingFunction)

        Survey.StylesManager.applyTheme("modern");
        
        

        const converter = new showdown.Converter();
        new QuestionExtensions();

        function loadData(loaded) {
            const questionModel = new Survey.Model(loaded);
            const get_url = window.location.search;
            const url_param = new URLSearchParams(get_url);
            for (let key of url_param.keys()) {
                if ( key == "q" )
                {
                    continue;
                }
                const value = url_param.get(key);
                questionModel.setValue(key, value)
            }
            questionModel.onStarted.add(() => {
                console.log('called')
            })
            questionModel.onProcessHtml.add((survey, options) => {
                if ( typeof options.html == "string" ) {
                    options.html = converter.makeHtml(options.html);
                }
            })
            questionModel.onTextMarkdown.add(function (survey, options) {
                
                let str = converter.makeHtml(options.text);
                if (options.hasOwnProperty('markdown')) {
                    console.log(options.markdown)
                    str = converter.makeHtml(options.markdown);
                }
                
                str = str.substring(3);
                str = str.substring(0, str.length - 4);
                
                options.html = str;
            });
            questionModel.showNavigationButtons = "false"
        
            
            questionModel.locale = "nb"
            
            questionModel.completedHtml = "Takk for at du gir tilbakemelding";
            questionModel.focusFirstQuestionAutomatic = false;
            
            $("#questions").Survey({ model: questionModel });

            if ( window.surveyChanged != null ) {
                questionModel.onValueChanged.add(window.surveyChanged)
            }
            if ( window.afterRenderQuestion != null ) {
                questionModel.onAfterRenderQuestion.add(window.afterRenderQuestion)
            }

            questionModel.currentPageNo = 0;

            

            return questionModel;
        }

        if ( data != null) {
            const get_url = window.location.search;
            const url_param = new URLSearchParams(get_url);
            const q = url_param.get('q');
            var code = ''
            newData = JSON.parse(data)
            if ( q && q.length > 0 ) {
                try {
                    var questions = JSON.parse(atob(q));
                    code = questions.code;
                    var allowed = ["radiogroup", "checkbox"];
                    if ( Array.isArray(questions.add) ) {
                       for ( var i = questions.add.length - 1; i >= 0; i--) {
                        if ( allowed.indexOf(questions.add[i].type) >= 0) {
                            newData.pages[0].elements = [questions.add[i]].concat(newData.pages[0].elements)
                        }
                       }
                    }
                } catch (ex) {
                    console.log(ex)

                }     
            }
            

            data = JSON.stringify(newData)
            let result = loadData(data)
            if ( code.length > 0 ) {
                result.setValue('code', code)
            }
        }
        else {
            const get_url = window.location.search;
            const url_param = new URLSearchParams(get_url);
            const source = url_param.get('source');
            fetch('/powercat-automation-kit/' + source + ".json")
                .then(async function (response) {
                    if (response.ok) {
                        loadData(await response.text());
                    }
                    throw new Error('Nettverksresponsen var ikke ok.');
                })
        }
    });
</script>


    </div>
  </div>
</article>

    
    
    <footer class="d-print-none">
    <nav class="navbar navbar-light bg-light d-flex justify-content-around">
  <div class="container pt-3">
    <div class="row d-flex justify-content-center">
      <div class="col-lg-2 col-md-6">
        <div class="footer-logo">
          <img src="https://microsoft.github.io/powercat-automation-kit/images/logos/automation-kit.svg">
        </div>
      </div>
      <div class="col-lg-2 col-md-6">
        <div class="footer-header">
            <h3>Produkt</h3>
        </div>
        <ul class="link-list">
          <li>
            <a rel="noopener" target="_blank" href="https://microsoft.github.io/powercat-automation-kit/nb/releases">
              Utgivelser
            </a>
          </li>
          <li>
            <a rel="noopener" target="_blank" href="https://microsoft.github.io/powercat-automation-kit/nb/frequently-asked-questions">
              Faq
            </a>
          </li>
          <li>
            <a rel="noopener" target="_blank" href="https://microsoft.github.io/powercat-automation-kit/nb/support">
              Støtte
            </a>
          </li>
          <li>
            <a rel="noopener" target="_blank" href="https://microsoft.github.io/powercat-automation-kit/nb/office-hours">
              Kontortid
            </a>
          </li>
          <li>
            <a rel="noopener" target="_blank" href="https://aka.ms/automation-kit-learn">
              Oppdag funksjoner
            </a>
          </li>
          <li>
            <a rel="noopener" target="_blank" href="https://aka.ms/ak4pp-issues">
              Problemer
            </a>
          </li>
          <li>
            <a rel="noopener" target="_blank" href="https://github.com/microsoft/powercat-automation-kit/milestones?status=open">
              Milepæler
            </a>
          </li>
          <li>
            <a rel="noopener" target="_blank" href="https://github.com/microsoft/powercat-automation-kit/releases">
              Utgivelser
            </a>
          </li>
          <li>
            <a rel="noopener" target="_blank" href="https://privacy.microsoft.com/privacystatement">
              Personvernpolicy
            </a>
          </li>
        </ul>
      </div>
      <div class="col-lg-2 col-md-6">
        <div class="footer-header">
            <h3>Lære</h3>
        </div>
        <ul class="link-list">
          <li>
            <a rel="noopener" target="_blank" href="https://learn.microsoft.com/power-automate/guidance/automation-kit/setup/prerequisites">
              Kom i gang
            </a>
          </li>
          <li>
            <a rel="noopener" target="_blank" href="https://learn.microsoft.com/power-automate/guidance/automation-kit/configure-automation-kit">
              Konfigurere automatiseringssettet
            </a>
          </li>
          <li>
            <a rel="noopener" target="_blank" href="https://learn.microsoft.com/power-automate/guidance/automation-kit/use-automation-kit">
              Bruk automatiseringssettet
            </a>
          </li>
        </ul>
      </div>
      <div class="col-lg-2 col-md-6">
        <div class="footer-header">
            <h3>Blogg</h3>
        </div>
        <ul class="link-list">
          <li>
            <a rel="noopener" target="_blank" href="https://aka.ms/automation-kit-blog">
              Offentlig forhåndsversjon
            </a>
          </li>
          <li>
            <a rel="noopener" target="_blank" href="https://powerautomate.microsoft.com/blog/cineplex-digital-transformation-with-power-automate-rpa-led-by-citizen-developers/">
              Cineplex Kundehistorie
            </a>
          </li>
        </ul>
      </div>
      <div class="col-lg-2 col-md-6">
        <div class="footer-header">
          <h3></h3>
          <nav class="level is-mobile">
            <div class="level-left">
              <a class="level-item" rel="noopener" target="_blank" href="https://github.com/microsoft/powercat-automation-kit">
                <span class="icon"><i class="fa fa-github"></i></span>
              </a>
            </div>
          </nav>
        </div>
      </div>
    </div>
  </div>

    </nav>
</footer>
    

    

    

    <script src="https://microsoft.github.io/powercat-automation-kit/js/jquery/3.6.1/jquery.min.js" ></script>
<script src="https://microsoft.github.io/powercat-automation-kit/js/feather-icons/4.29.0/feather.min.js" ></script>
<script src="https://microsoft.github.io/powercat-automation-kit/js/modernizr/2.8.3/modernizr.min.js" ></script>
<script src="https://microsoft.github.io/powercat-automation-kit/js/survey-jquery/1.9.55/survey.jquery.min.js" ></script>
<script src="https://microsoft.github.io/powercat-automation-kit/js/showdown/2.1.0/showdown.min.js" ></script>
</html>